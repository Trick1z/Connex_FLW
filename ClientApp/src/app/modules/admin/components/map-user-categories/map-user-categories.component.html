<app-head-underline [title]="'Mapping User - Categories'"></app-head-underline>

<div class="mt-20 ml-20 mr-20 categroy-box ">
    <app-head-underline [title]="'Support User'"></app-head-underline>





    <div class="ml-10 groups">

        <div class="max-w-sm search-box">
            <app-text-box  [value]="searchUsernameValue" (onValueChanged)="onSearchValueChange($event)" [placeHolder]="'Search By Username'"></app-text-box>
        </div>

        <div class="mt-1 app-btn">
            <app-button (clicked)="onSearch()" [message]="'Search'"></app-button>
        </div>


    </div>

    <dx-data-grid #userGrid class="flex m-10 max-w-max " [dataSource]="userByRoleDataSource" [showBorders]="true"
        [columnAutoWidth]="true">


        <dxo-paging [pageSize]="5" [pageIndex]="0"> <!-- Shows the second page -->
        </dxo-paging>

        <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[10, 20, 50]" [showNavigationButtons]="true">
        </dxo-pager>


        <dxo-remote-operations [filtering]="false" [paging]="true" [sorting]="true" [summary]="false" [grouping]="false"
            [groupPaging]="false">
        </dxo-remote-operations>

        <!-- <dxo-search-panel [visible]="true" [width]="240" placeholder="Search..."></dxo-search-panel> -->


        <dxi-column dataField="userId" caption="ID" width="80" alignment="center"></dxi-column>
        <dxi-column dataField="username" caption="ชื่อ" minWidth="150" alignment="left"></dxi-column>
        <dxi-column dataField="roleName" caption="Role" minWidth="150" alignment="center"></dxi-column>

        <dxi-column caption="Action" width="200" [fixed]="true" [fixedPosition]="'right'" cellTemplate="actionTemplate"
            alignment="center">
        </dxi-column>
        <div *dxTemplate="let cell of 'actionTemplate'">
            <dx-button class="m-2" (onClick)="getViewUserDetail(cell.data)" text="Info" type="default"
                stylingMode="contained"></dx-button>
            <dx-button class="m-2" (onClick)="onMapDetailPopupShow(cell.data)" text="Map" type="success"
                stylingMode="contained"></dx-button>
        </div>
    </dx-data-grid>
</div>

<div *ngIf="userMapCategories" class="product-popup">

    <dx-popup [height]="300" [(visible)]="mapDetailVisible" [width]="500" [showTitle]="true"
        [closeOnOutsideClick]="true" title="Map Categories" (onHiding)="onMapDetailPopupHide()">
        <div class="popup-content">
            <div class="flex justify-start" id="">
                <div class="flex justify-start text-2xl user-box">
                    <span class="label">User : </span>
                    <span class="mb-5 ml-5 username"> {{ labelUsername }}</span>
                </div>

                <div class="flex justify-start ml-10 text-2xl user-box">
                    <span class="label">Role : </span>
                    <span class="mb-5 ml-5 username"> {{ labelRole }}</span>
                </div>

            </div>
            <dx-tag-box [dataSource]="categoriesTagDataSource" displayExpr="showText" valueExpr="value"
                (onValueChanged)="onChange($event)" [value]="userMapCategories.categories"
                [showSelectionControls]="true">
            </dx-tag-box>
            <div class="flex items-end justify-center gap-2 h-28">
                <app-button (clicked)="onSaveSubmit()" [message]="'Save'"></app-button>
                <app-button (clicked)="onViewPopupHide() " color="red" [message]="'Close'"></app-button>
            </div>


        </div>
    </dx-popup>
</div>
<!-- view popup-->
<dx-popup [height]="300" [(visible)]="viewPopupDetail" [width]="500" [showTitle]="true" [closeOnOutsideClick]="true"
    title="User Info" (onHiding)="onViewPopupHide()">
    <div class="popup-content">
        <div class="flex justify-start" id="">
            <div class="flex justify-start text-2xl user-box">
                <span class="label">User : </span>
                <span class="ml-5 username"> {{ viewUsername }}</span>
            </div>

            <div class="flex justify-start ml-10 text-2xl user-box">
                <span class="label">Role : </span>
                <span class="ml-5 username"> {{ viewRole }}</span>
            </div>

        </div>
        <app-head-underline [title]="'Categories'"></app-head-underline>
        <div class="grid grid-cols-5 gap-1 mt-5 categories-item" *ngIf="viewUserDetail.length > 0 ;else noViewData">
            <app-button *ngFor="let item of viewUserDetail" [color]="'blue'" [message]="item"></app-button>
        </div>
        <ng-template #noViewData>
            <div class="flex justify-center mt-10">
                <p class="text-gray-500">No categories mapped for this user.</p>
            </div>
        </ng-template>
    </div>
</dx-popup>
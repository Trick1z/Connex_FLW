<app-head-underline [color]="underlineColor.green" [title]="'User Form'"></app-head-underline>
<div class="flex justify-start max-w-full ml-10 mr-10 items- search-box">
  <div class="gap-4 space-y-4 text-end text-box">

    <div class="flex items-center">
      <label class="w-40 mr-2 font-bold">Document Number </label>
      <div class="flex-1">
        <app-text-box class="w-full" (onValueChanged)="onDocumentChange($event)" [value]="documentNumberSearch!"
          [placeHolder]="'Document Number'">
        </app-text-box>
      </div>

    </div>

    <div class="flex items-center">
      <label class="w-40 mr-2 font-bold">Product Name</label>
      <div class="flex-1">
        <app-text-box class="w-full" (onValueChanged)="onProductNameChange($event)" [value]="productName!"
          [placeHolder]="'Product Name'">
        </app-text-box>
      </div>
    </div>

    <div class="flex items-center">
      <label class="w-40 mr-2 font-bold">Start Date</label>
      <dx-date-box [value]="startDate!" (onValueChanged)="onStartDateChange($event)" displayFormat="dd/MM/yyyy"
        type="date" placeholder="Start Date" width="200">
      </dx-date-box>
    </div>

    <div class="flex items-center">
      <label class="w-40 mr-2 font-bold">End Date</label>

      <dx-date-box [value]="endDate!" (onValueChanged)="onEndDateChange($event)" displayFormat="dd/MM/yyyy" type="date"
        placeholder="End Date" width="200">
      </dx-date-box>
    </div>

  </div>

  <div class="ml-10">
    <div class="flex items-start text-end">
      <label for="check-box" class="w-20 mr-2 font-bold">Categories</label>
      <app-check-box [options]="categoriesCheckBoxItem" (optionsChange)="onCategoriesCheck($event)">
      </app-check-box>
    </div>

    <div class="flex items-start mt-10 text-end">
      <label for="check-box" class="w-20 mr-2 font-bold">Status</label>
      <app-check-box [options]="statusCheckBoxItem" (optionsChange)="onStatusCodeCheck($event)">
      </app-check-box>
    </div>
  </div>

</div>
<div class="mt-3 ml-52">
  <app-button (clicked)="onSearchClicked()" class="" [color]="buttonColor.Search" [message]="'Search'">

  </app-button>
</div>

<app-head-underline [color]="underlineColor.black"></app-head-underline>

<!-- (onRowExpanding)="onMasterDetailRowExpanding($event.key.formId)"  -->
<div class="px-2 py-2 m-5 bg-white rounded-lg shadow-2xl gap-y-8">
  <app-head-underline [color]="underlineColor.black" [title]="'Open Issues'"></app-head-underline>
  <div class="my-5">
    <dx-data-grid #openFormGrid [dataSource]="openFormsDataSource" keyExpr="formId" [showBorders]="true"
      [masterDetail]="{ enabled: true, template: 'unsuccessDetail'  }" [paging]="{ enabled: true, pageSize: 5 }">

      <dxo-paging [pageSize]="5"></dxo-paging>
      <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5,10,20]" [showInfo]="true"></dxo-pager>

      <dxi-column alignment="center" dataField="docNo" caption="Document Number"></dxi-column>

      <dxi-column dataField="status" caption="Status" cellTemplate="statusCell" alignment="center"></dxi-column>
      <div *dxTemplate="let cell of 'statusCell'">
        <span [ngClass]="getStatusClass(cell.data.status)">
          {{ cell.data.status }}
        </span>
      </div>

      <dxi-column alignment="center" dataField="progressing" caption="Progressing"></dxi-column>

      <dxi-column alignment="left" dataField="modifiedBy" caption="Modified By"></dxi-column>

      <dxi-column alignment="center" dataField="modifiedTime" caption="Modified Time"
        cellTemplate="modifiedTimeCell"></dxi-column>

      <div *dxTemplate="let cell of 'modifiedTimeCell'">
        {{ cell.data.modifiedTime | date:'dd MMM yyyy HH:mm' }}
      </div>
      <dxi-column alignment="center" width="160" caption="Actions" cellTemplate="actionCell"></dxi-column>

      <div *dxTemplate="let detail of 'actionCell'">
        <div *ngIf="!detail.data.canClose" class="flex justify-center space-x-2">
          <app-button (clicked)="onEditClicked(detail.data)" [color]="buttonColor.Edit" [message]="'Edit'"></app-button>
          <app-button (clicked)="onFormDeleteClicked(detail.data)" [color]="buttonColor.Delete"
            [message]="'Delete'"></app-button>
        </div>

        <div *ngIf="detail.data.canClose">
          <app-button [color]="buttonColor.CloseForm" (clicked)="onCloseFormClicked(detail.data)"
            [message]="'Close Form'"></app-button>
        </div>

      </div>

      <div *dxTemplate="let masterData of 'unsuccessDetail'">
        <dx-data-grid (onContentReady)="onDetailGridContentReady($event, masterData.data.formId)" [showBorders]="true"
          [columnAutoWidth]="true">
          <dxi-column dataField="issueCategoriesName" caption="Category"></dxi-column>
          <dxi-column alignment="left" dataField="productName" caption="Product"></dxi-column>
          <dxi-column dataField="quantity" caption="Quantity"></dxi-column>
          <dxi-column alignment="center" dataField="location" caption="Location"></dxi-column>
          <dxi-column cellTemplate="detectedCell" alignment="center" dataField="detectedTime"
            caption="Detected Time"></dxi-column>
          <div *dxTemplate="let cell of 'detectedCell'">
            {{ cell.data.detectedTime | date:'dd MMM yyyy HH:mm' }}
          </div>
          <!-- 
          <dxi-column dataField="status" caption="Status" cellTemplate="statusCell" alignment="center"></dxi-column>
          <div *dxTemplate="let cell of 'statusCell'">
            <span [ngClass]="getStatusClass(cell.data.status)">
              {{ cell.data.status }}
            </span>
          </div> -->

          <dxi-column dataField="status" caption="Status" cellTemplate="statusCell" alignment="center"></dxi-column>
          <div *dxTemplate="let cell of 'statusCell'">
            <a href="javascript:void(0)" [ngClass]="getStatusClass(cell.data.status)"
              (click)="TaskLogPopupOpenClicked(cell.data)">
              {{ cell.data.status }}
            </a>
          </div>



        </dx-data-grid>
      </div>
    </dx-data-grid>
  </div>


</div>



<div class="p-5 px-2 m-5 bg-white rounded-lg shadow-2xl">

  <div class="my-4">
    <app-head-underline [color]="underlineColor.black" [title]="'Closed Issues'"></app-head-underline>

    <dx-data-grid #openFormGrid [dataSource]="closedFormsDataSource" keyExpr="formId" [showBorders]="true"
      [masterDetail]="{ enabled: true, template: 'unsuccessDetail'  }" [paging]="{ enabled: true, pageSize: 5 }">

      <dxo-paging [pageSize]="5"></dxo-paging>
      <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5,10,20]" [showInfo]="true"></dxo-pager>

      <dxi-column alignment="center" dataField="docNo" caption="Document Number"></dxi-column>

      <dxi-column dataField="status" caption="Status" cellTemplate="statusCell" alignment="center"></dxi-column>
      <div *dxTemplate="let cell of 'statusCell'">
        <span [ngClass]="getStatusClass(cell.data.status)">
          {{ cell.data.status }}
        </span>
      </div>

      <dxi-column alignment="center" dataField="progressing" caption="Progressing"></dxi-column>

      <dxi-column alignment="center" dataField="modifiedBy" caption="Modified By"></dxi-column>
      <dxi-column alignment="center" dataField="modifiedTime" caption="Modified Time"
        cellTemplate="modifiedTimeCell"></dxi-column>

      <div *dxTemplate="let cell of 'modifiedTimeCell'">
        {{ cell.data.modifiedTime | date:'dd MMM yyyy HH:mm' }}
      </div>

      <div *dxTemplate="let masterData of 'unsuccessDetail'">
        <dx-data-grid (onContentReady)="onDetailGridContentReady($event, masterData.data.formId)" [showBorders]="true"
          [columnAutoWidth]="true">
          <dxi-column dataField="issueCategoriesName" caption="Category"></dxi-column>
          <dxi-column alignment="left" dataField="productName" caption="Product"></dxi-column>
          <dxi-column dataField="quantity" caption="Quantity"></dxi-column>
          <dxi-column alignment="center" dataField="location" caption="Location"></dxi-column>
          <dxi-column cellTemplate="detectedCell" alignment="center" dataField="detectedTime"
            caption="Detected Time"></dxi-column>



          <div *dxTemplate="let cell of 'detectedCell'">
            {{ cell.data.detectedTime | date:'dd MMM yyyy HH:mm' }}
          </div>

          <dxi-column dataField="status" caption="Status" cellTemplate="statusCell" alignment="center"></dxi-column>
          <div *dxTemplate="let cell of 'statusCell'">
            <span [ngClass]="getStatusClass(cell.data.status)">
              {{ cell.data.status }}
            </span>
          </div>




        </dx-data-grid>
      </div>
    </dx-data-grid>
  </div>

</div>


<!-- popup -->

<!-- task log -->
<dx-popup [width]="600" [height]="600" [showTitle]="true" [dragEnabled]="true" [closeOnOutsideClick]="true"
  [title]="'ActionLog'" (onHiding)="TaskLogPopupCloseClicked()" [(visible)]="isTaskPopupVisible">

  <div class="">
    <dx-data-grid [dataSource]="taskLogDetail" [showBorders]="true" [columnAutoWidth]="true">
      <dxi-column dataField="username" caption="Username"></dxi-column>

      <dxi-column dataField="action" caption="Action" cellTemplate="statusCell" alignment="center"></dxi-column>
      <div *dxTemplate="let cell of 'statusCell'">
        <span [ngClass]="getActionClass(cell.data.action)">
          {{ cell.data.action }}
        </span>
      </div>

      <dxi-column cellTemplate="actionCell" alignment="center" dataField="actionTime"
        caption="Action Time"></dxi-column>
      <div *dxTemplate="let cell of 'actionCell'">
        {{ cell.data.actionTime | date:'dd MMM yyyy HH:mm' }}
      </div>


    </dx-data-grid>
  </div>
</dx-popup>
<app-head-underline [title]="'Support Assignments'"></app-head-underline>

<div class="px-2 py-2 mx-10 mt-10 bg-white rounded-lg shadow-2xl">

    <app-head-underline [color]="underlineColor.black" [title]="'Waiting Task'"></app-head-underline>

    <div class="flex items-start max-w-full my-5 ml-10 mr-10 search-box">
        <div class="gap-4 space-y-4 text-end text-box">

            <div class="flex items-center">
                <label class="w-40 mr-2 font-bold">Document Number </label>
                <div class="flex-1">
                    <app-text-box class="w-full" [value]="fieldDocNo!" (onValueChanged)="onDocumentChange($event)"
                        [placeHolder]="'Document Number'">
                    </app-text-box>
                </div>
            </div>
            <div class="flex">
                <label class="w-40 mr-2 font-bold">Start Date</label>

                <dx-date-box [value]="startDate!" (onValueChanged)="onStartDateChange($event.value)"
                    displayFormat="dd/MM/yyyy" type="date" placeholder="Start Date" width="200">
                </dx-date-box>
            </div>
            <div class="flex">
                <label class="w-40 mr-2 font-bold">End Date</label>
                <dx-date-box [value]="endDate!" (onValueChanged)="onEndDateChange($event.value)"
                    displayFormat="dd/MM/yyyy" type="date" placeholder="End Date" width="200">
                </dx-date-box>
            </div>
        </div>

        <div class="flex ml-10 ">
            <div class="items-center">
                <label for="check-box" class="w-40 font-bold">Categories</label>
                <app-check-box [options]="categoriesCheckBoxItem" (optionsChange)="onCategoriesChanged($event)">
                </app-check-box>
            </div>
        </div>
    </div>
    <div class="ml-52">
        <app-button (clicked)="onSearchClicked()" [color]="buttonColor.Search" [message]="'Search'">
        </app-button>
    </div>

    <app-head-underline [color]="underlineColor.black"></app-head-underline>

    <div class="pl-10 pr-10 datagrid-assignment">
        <dx-data-grid #unassignedGrid [dataSource]="unassignedTaskDataSource" keyExpr="taskSeq" [showBorders]="true"
            [paging]="{ enabled: true, pageSize: 5 }" [selection]="{ mode: 'multiple', showCheckBoxesMode: 'always' }"
            (onSelectionChanged)="onUnassignedSelectionChanged($event)">>

            <dxo-paging [pageSize]="5"></dxo-paging>
            <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20]" [showInfo]="true"></dxo-pager>

            <dxi-column [headerCellTemplate]="'wrapHeader'" dataField="docNo" caption="Document Number" minWidth="80"
                width="100" alignment="center"></dxi-column>

            <dxi-column dataField="issueCategoriesName" caption="Category" minWidth="100" width="120"
                alignment="left"></dxi-column>

            <dxi-column dataField="productName" caption="ProductName" minWidth="120" alignment="left"></dxi-column>

            <dxi-column dataField="br_Qty" caption="Quantity" minWidth="80" width="100"></dxi-column>

            <dxi-column dataField="rp_Location" caption="Location" minWidth="100" alignment="center"></dxi-column>

            <!-- <dxi-column dataField="detectedTime" caption="detected Time" minWidth="200" width="200"
                alignment="center"></dxi-column> -->

            <dxi-column alignment="center" dataField="detectedTime" caption="Detected Time"
                cellTemplate="detectedTimeCell"></dxi-column>

            <div *dxTemplate="let cell of 'detectedTimeCell'">
                {{ cell.data.detectedTime | date:'dd MMM yyyy HH:mm' }}
            </div>

            <dxi-column dataField="systemStatusCode" caption="Status" minWidth="80" width="140"
                alignment="center"></dxi-column>

            <dxi-column *ngIf="!isUnassignedMultiSelected" [fixed]="true" [fixedPosition]="'right'" caption="Actions"
                width="120" alignment="center" [cellTemplate]="'actionCell'"></dxi-column>

            <div class="space-x-2 " *dxTemplate="let cell of 'actionCell'">
                <app-button [color]="buttonColor.Take" [message]="'Take'" (clicked)="onSubmit(cell.data , 'Assigned')">
                </app-button>
            </div>




            <div *dxTemplate="let cellData of 'wrapCell'" class="text-center break-words whitespace-normal">
                {{ cellData.value }}
            </div>
            <div *dxTemplate="let headerData of 'wrapHeader'" class="text-center break-words whitespace-normal">
                {{ headerData.column.caption }}
            </div>

        </dx-data-grid>


        <div class="mt-2" *ngIf="isUnassignedMultiSelected">
            <app-button (clicked)="onUnassignedSelectedSubmit()"  [color]="buttonColor.Take" [message]="'Take Selected'">
            </app-button>
        </div>
    </div>
</div>


<div class="px-2 py-2 m-10 my-5 bg-white rounded-lg shadow-2xl">

    <app-head-underline [color]="underlineColor.black" [title]="'Process Task'"></app-head-underline>
    <div class="flex justify-end space-x-2 " id="">
    </div>

    <div class="m-10">
        <dx-data-grid #assignedGrid [dataSource]="assignedTaskDataSource" keyExpr="taskSeq" [showBorders]="true"
            [paging]="{ enabled: true, pageSize: 5 }" [selection]="{ mode: 'multiple', showCheckBoxesMode: 'always' }"
            (onSelectionChanged)="onAssignedSelectionChanged($event)">

            <dxo-paging [pageSize]=" 5"></dxo-paging>
            <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20]" [showInfo]="true"></dxo-pager>

            <dxi-column [headerCellTemplate]="'wrapHeader'" dataField="docNo" caption="Document Number" minWidth="80"
                width="100" alignment="center"></dxi-column>

            <dxi-column dataField="issueCategoriesName" caption="Category" minWidth="100" width="120"
                alignment="left"></dxi-column>

            <dxi-column dataField="productName" caption="ProductName" minWidth="120" alignment="left"></dxi-column>

            <dxi-column dataField="br_Qty" caption="Quantity" minWidth="80" width="100"></dxi-column>

            <dxi-column dataField="rp_Location" caption="Location" minWidth="100" width="150"
                alignment="center"></dxi-column>

            <dxi-column alignment="center" dataField="detectedTime" caption="Detected Time"
                cellTemplate="detectedTimeCell"></dxi-column>

            <div *dxTemplate="let cell of 'detectedTimeCell'">
                {{ cell.data.detectedTime | date:'dd MMM yyyy HH:mm' }}
            </div>

            <dxi-column dataField="systemStatusCode" caption="Status" minWidth="80" width="140"
                alignment="center"></dxi-column>

            <dxi-column *ngIf="!isAssignedMultiSelected" [fixed]="true" [fixedPosition]="'right'" caption="Actions"
                width="250" alignment="center" [cellTemplate]="'actionCell'"></dxi-column>

            <div class="space-x-2" *dxTemplate="let cell of 'actionCell'">
                <app-button [color]="buttonColor.Save"[message]="'Done'"
                    (clicked)="onSubmit(cell.data,'Done','AssignedJob')"></app-button>

                <app-button [color]="buttonColor.Reject" [message]="'Reject'"
                    (clicked)=" onSubmit(cell.data,'Rejected','AssignedJob')"></app-button>
                <app-button [color]="buttonColor.TaskCancel" [message]="'Cancel'"
                    (clicked)=" onSubmit(cell.data,'CancelAssigned','AssignedJob')"></app-button>
            </div>


            <div *dxTemplate="let cellData of 'wrapCell'" class="text-center break-words whitespace-normal">
                {{ cellData.value }}
            </div>
            <div *dxTemplate="let headerData of 'wrapHeader'" class="text-center break-words whitespace-normal">
                {{ headerData.column.caption }}
            </div>
        </dx-data-grid>

        <div *ngIf="isAssignedMultiSelected" class="mt-2 space-x-2">
            <app-button (clicked)="onAssignedSelectedSubmit('Done')"
             [color]="buttonColor.Save" [message]="'Done Selected'">
            </app-button>
            <app-button (clicked)="onAssignedSelectedSubmit('Rejected')" [color]="buttonColor.Reject" [message]="'Reject Selected'"></app-button>
            <app-button (clicked)="onAssignedSelectedSubmit('CancelAssigned')" [color]="buttonColor.TaskCancel" [message]="'Cancel Selected'"></app-button>
        </div>
    </div>
</div>



<div class="px-2 py-2 mx-10 my-5 bg-white rounded-lg shadow-2xl">

    <app-head-underline [color]="underlineColor.black" [title]="'Done Task'"></app-head-underline>
    <div class="flex justify-end" id="">
    </div>
    <div class="flex m-5">
        <dx-data-grid #doneGrid [dataSource]="doneTaskDataSource" keyExpr="taskSeq" [showBorders]="true"
            [paging]="{ enabled: true, pageSize: 5 }">

            <dxo-paging [pageSize]="5"></dxo-paging>
            <dxo-pager [showPageSizeSelector]="true" [allowedPageSizes]="[5, 10, 20]" [showInfo]="true"></dxo-pager>

            <dxi-column [headerCellTemplate]="'wrapHeader'" dataField="docNo" caption="Document Number" minWidth="80"
                width="100" alignment="center"></dxi-column>
            <dxi-column dataField="issueCategoriesName" caption="Category" minWidth="100" width="120"
                alignment="left"></dxi-column>
            <dxi-column dataField="productName" caption="ProductName" minWidth="120" alignment="left"></dxi-column>
            <dxi-column dataField="br_Qty" caption="Quantity" minWidth="80" width="100"></dxi-column>
            <dxi-column dataField="rp_Location" caption="Location" minWidth="100" width="150"
                alignment="center"></dxi-column>
            <dxi-column alignment="center" dataField="detectedTime" caption="Detected Time"
                cellTemplate="detectedTimeCell"></dxi-column>

            <div *dxTemplate="let cell of 'detectedTimeCell'">
                {{ cell.data.detectedTime | date:'dd MMM yyyy HH:mm' }}
            </div>
            <dxi-column dataField="systemStatusCode" caption="Status" minWidth="80" width="140"
                alignment="center"></dxi-column>


            <dxi-column [fixed]="true" [fixedPosition]="'right'" caption="Actions" width="120" alignment="center"
                [cellTemplate]="'actionCell'"></dxi-column>
            <div class="space-x-2" *dxTemplate="let cell of 'actionCell'">

                <div class="" *ngIf="cell.data.canCancelDone">

                    <app-button [color]="buttonColor.Cancel" [message]="'Cancel'"
                        (clicked)=" onSubmit(cell.data,'CancelCompleted')"></app-button>



                </div>
            </div>




            <div *dxTemplate="let cellData of 'wrapCell'" class="text-center break-words whitespace-normal">
                {{ cellData.value }}
            </div>
            <div *dxTemplate="let headerData of 'wrapHeader'" class="text-center break-words whitespace-normal">
                {{ headerData.column.caption }}
            </div>
        </dx-data-grid>

    </div>
</div>